\chapter{Advanced Topics}
\newpage
\section{\label{ref:CustomisingUI}Customising the userinterface}
\subsection{\label{ref:GettingExtras}Getting Extras (Fonts,Languages)}
Rockbox supports custom fonts (for the Recorder and Ondio only) and a number of different languages. Rockbox 2.4 comes with 41 fonts and 24 languages already included. If new fonts and language files have been created, then they will be found at \url{http://www.rockbox.org/fonts/} and \url{http://www.rockbox.org/lang/}.

\subsection{\label{ref:LoadingForts}Loading Fonts (Recorder, Ondio)}
Rockbox can load fonts dynamically. Simply copy the .fnt file to the
disk and ``play'' them in the directory browser or select \textbf{General Settings {\textgreater} Fonts} from the Main Menu .

If you want a font to be loaded automatically every time you start up,
it must be located in the \textbf{/.rockbox }folder and the file name
must be at most 24 characters long.

Any BDF font file up to 16 pixels high should be usable with Rockbox. To
convert from .bdf to .fnt, use the convbdf tool. This tool can be found
on the Rockbox website 
(Linux: \url{http://www.rockbox.org/fonts/convbdf}, Windows: \url{http://www.rockbox.org/fonts/convbdf.exe}).

\subsection{\label{ref:Loadinglanguages}Loading Languages}
Rockbox can load language files at runtime. Simply copy the .lng file
(do not use the .lang file) to the Jukebox and
``play'' it in the Rockbox directory browser
or select \textbf{General Settings {}-{\textgreater} Languages }from
the Main Menu. 

If you want a language to be loaded automatically every time you start
up, it must be located in the \textbf{/.rockbox }folder and the file
name must be a maximum of 24 characters long.

Rockbox supports many different languages. You can get .lng files at
\url{http://www.rockbox.org/lang/}. 
Currently all of these languages are included in the Rockbox
distribution.

If your language is not yet supported and you want to write your own
language file,  follow these instructions:

\begin{itemize}
\item Copy the\url{./ http://www.rockbox.org/lang/english.lang }file and start filling in the ``new:'' lines. 
\item Name your file {\textless}language{\textgreater}.lang, where
{\textless}language{\textgreater} is the local name for your language. i.e. svenska.lang, francais.lang etc. 
\item When you are done, submit your .lang file to Rockbox patch
tracker.
(\url{http://sourceforge.net/tracker/?group_id=44306&atid=439120})
\end{itemize}

\section{\label{ref:ConfiguringtheWPS}Configuring the WPS}

\subsection{Description / General Info}

\begin{itemize}
\item The Custom While Playing Screen (WPS) display is used as a means to customise the WPS to the user's likings.
\item After editing the .wps file, ``play'' it to make it take effect.
\item All characters not preceded by \% are displayed as typed.
\item Lines beginning with \# are comments and will be ignored.
\item Maximum file size used is \opt{recorder,recorderv2fm,ondio,h1xx,h300,ipodcolor,ipodnano}{1600}\opt{player}{400} bytes. If you have a bigger WPS file, only the first part of it will be loaded and used.
\end{itemize}

\subsection{File Location}
Custom WPS files may be located anywhere on the drive. The only restriction is that they must end in .wps. When you ``play'' a .wps file, it will be used for future WPS screens. If the ``played'' .wps file is located in the /.rockbox folder, it will be remembered and used after reboot. The .wps filename must be no more than 24 characters long for it to be remembered.

\subsection{How To Create A .wps File}
Quite simply, enter the WPS code in your favourite text editor, Notepad on Windows works fine. When you save it, instead of saving it as a .txt file, save it as a .wps file. Example: Instead of Rockbox.txt, save the file as Rockbox.wps. To make sure non english characters display correctly in your WPS you must save the .wps file with UTF-8 character encoding. This can be done in most editors, for example Notepad in Windows 2000 or XP (but not in 9x/ME) can do this.

\subsection{Tags}

\subsubsection{Status Bar}
\begin{center}
  \begin{tabular}{@{}ll@{}}\toprule
    \textbf{Tag} & \textbf{Description}\\\midrule
    \%we & Status Bar Enabled\\
    \%wd & Status Bar Disabled\\\bottomrule
  \end{tabular}
\end{center}
These tags override the player setting for the display of the status bar, they must be on their own line.

\subsubsection{ID3 Info}
\begin{center}
  \begin{tabular}{@{}ll@{}}\toprule
    \textbf{Tag} & \textbf{Description}\\\midrule
    \%ia & ID3 Artist\\
    \%ic & ID3 Composer\\
    \%id & ID3 Album Name\\
    \%ig & ID3 Genre Name\\
    \%in & ID3 Track Number\\
    \%it & ID3 Track Title\\
    \%iv & ID3 Version (1.0, 1.1, 2.2, 2.3, 2.4 or empty if no id3 tag)\\
    \%iy & ID3 Year\\\bottomrule
  \end{tabular}
\end{center}
Remember that this information is not always available, so use the conditionals to show alternate information in preference to assuming.

\subsubsection{Battery Info}
\begin{center}
  \begin{tabular}{@{}ll@{}}\toprule
    \textbf{Tag} & \textbf{Description}\\\midrule
    \%bl & Show numeric battery level in percent.\\
         & Can also be used in a conditional: \%?bl{\textless}0{\textbar}1{\textbar}2{\textbar}3{\textbar}4{\textgreater}\\
    \%bv & Show the battery level in volts\\
    \%bt & Show estimated battery time left\\
    \%bp & "p" if the charger is connected \\
         & (only on targets that can charge batteries)\\
    \%bc & "c" if the unit is currently charging the battery\\
         & (only on targets that have software charge control or monitoring)\\\bottomrule
  \end{tabular}
\end{center}

\subsubsection{File Info}
\begin{center}
  \begin{tabular}{@{}ll@{}}\toprule
    \textbf{Tag} & \textbf{Description}\\\midrule
    \%fb & File Bitrate (in kbps)\\
    \%fc & File Codec (e.g. "MP3" or "FLAC")\\
         & This tag can also be used in a conditional tag,\\
         & \%?fc{\textless}mp1{\textbar}mp2{\textbar}mp3{\textbar}wav{\textbar}vorbis{\textbar}flac{\textbar}mpc{\textbar}a52{\textbar}wavpack{\textbar}unknown{\textgreater}\\
         & The codec order is as follows: MP1, MP2, MP3, WAV, Ogg Vorbis (OGG),\\
         & FLAC, MPC, AC3, WavPack (WV), ALAC, AAC, Shorten (SHN), AIFF\\
    \%ff & File Frequency (in Hz)\\
    \%fm & File Name\\
    \%fn & File Name (without extension)\\
    \%fp & File Path\\
    \%fs & File Size (In Kilobytes)\\
    \%fv & "(avg)" if variable bit rate or "" if constant bit rate\\
    \%d1 & First directory from end of file path.\\
    \%d2 & Second directory from end of file path.\\
    \%d3 & Third directory from end of file path.\\\bottomrule
  \end{tabular}
\end{center}
Example for the the \%dN commands: If the path is "/Rock/Kent/Isola/11 - 747.mp3", \%d1 is "Isola", \%d2 is "Kent"... You get the picture.

\subsubsection{Playlist/Song Info}
\begin{center}
  \begin{tabular}{@{}ll@{}}\toprule
    \textbf{Tag} & \textbf{Description}\\\midrule
    \%pb & Progress Bar
    \opt{player}{
         & This will display a 1 character "cup" \\
         & that empties as the time progresses.}\\
    \opt{recorder,recorderv2fm,h1xx,h300,ipodcolor,ipodnano}{
         & This will replace the entire line with a progress bar. \\
         & You can set the height, position and width of the progressbar\\
         & (in pixels): \%pb{\textbar}height{\textbar}leftpos{\textbar}rightpos{\textbar}} \\
    \%pf & Player: Full-line progress bar + time display\\
    \%pc & Current Time In Song\\
    \%pe & Total Number of Playlist Entries\\
    \%pm & Peak Meter (Recorder only) The entire line is used as volume peak meter.\\
    \%pn & Playlist Name (Without path or extension)\\
    \%pp & Playlist Position\\
    \%pr & Remaining Time In Song\\
    \%ps & Shuffle. Shows 's' if shuffle mode is enabled.\\
    \%pt & Total Track Time\\
    \%pv & Current volume. Can also be used in a conditional: \\
         & \%?pv{\textless}0{\textbar}1{\textbar}2{\textbar}3{\textbar}4{\textbar}5{\textbar}6{\textbar}7{\textbar}8{\textbar}9{\textbar}10{\textgreater}\\\bottomrule
  \end{tabular}
\end{center}

\subsubsection{Runtime Database}
\begin{center}
  \begin{tabular}{@{}ll@{}}\toprule
    \textbf{Tag} & \textbf{Description}\\\midrule
    \%rp & Song playcount\\
    \%rr & Song rating (0-10). This tag can also be used in a conditional tag,\\
         & \%?rr{\textless}0{\textbar}1{\textbar}2{\textbar}3{\textbar}4{\textbar}5{\textbar}6{\textbar}7{\textbar}8{\textbar}9{\textbar}10{\textgreater}\\\bottomrule
  \end{tabular}
\end{center}

\opt{h1xx,h300}{
\subsubsection{Hold Switches}
\begin{center}
  \begin{tabular}{@{}ll@{}}\toprule
    \textbf{Tag} & \textbf{Description}\\\midrule
    \%mh & "h" if the main unit hold switch is on\\
    \%mr & "r" if the remote hold switch is on\\\bottomrule
  \end{tabular}
\end{center}
}

\subsubsection{Virtual LED}
\begin{center}
  \begin{tabular}{@{}ll@{}}\toprule
    \textbf{Tag} & \textbf{Description}\\\midrule
    \%lh & "h" if there is hard disk activity\\\bottomrule
  \end{tabular}
\end{center}

\subsubsection{Repeat Mode}
\begin{center}
  \begin{tabular}{@{}ll@{}}\toprule
    \textbf{Tag} & \textbf{Description}\\\midrule
    \%mm & Repeat mode, 0-4, in the order: Off, All, One, Shuffle, \opt{player,recorder,recorderv2fm}{A-B}\\\bottomrule
  \end{tabular}
\end{center}
Example: \%?mm{\textless}Off{\textbar}All{\textbar}One{\textbar}Shuffle{\textbar}A-B{\textgreater}

\subsubsection{Playback Mode Tags}
\begin{center}
  \begin{tabular}{@{}ll@{}}\toprule
    \textbf{Tag} & \textbf{Description}\\\midrule
    \%mp & Play status, 0-4, in the order: Stop, Play, Pause, Fast forward, Rewind\\\bottomrule
  \end{tabular}
\end{center}
Example: \%?mp{\textless}Stop{\textbar}Play{\textbar}Pause{\textbar}Ffwd{\textbar}Rew{\textgreater}

\subsubsection{Images}
\begin{center}
  \begin{tabular}{@{}ll@{}}\toprule
    \textbf{Tag} & \textbf{Description}\\\midrule
    \%X{\textbar}filename.bmp{\textbar} & Load and set a backdrop image for the WPS.\\
                      & This image must be exactly the same size as your LCD.\\
    \%P{\textbar}filename.bmp{\textbar} & Load a Progress bar image for the WPS.\\
                      & Use \%pb tag to show the progress bar\\
    \%x{\textbar}n{\textbar}filename{\textbar}x{\textbar}y{\textbar} & Load and display an image\\
                        & n = image ID (a-z and A-Z)\\
                        & filename = filename (relative to /.rockbox/ and including .bmp)\\
                        & x = x coordinate\\
                        & y = y coordinate.\\
    \%xl{\textbar}n{\textbar}filename{\textbar}x{\textbar}y{\textbar} & Preload an image for later display\\
                         & n = image ID (a-z and A-Z)\\
                         & filename = filename (relative to /.rockbox/ and including .bmp)\\
                         & x = x coordinate\\
                         & y = y coordinate.\\
    \%xdn & Display a preloaded image\\

          & n = image ID (a-z and A-Z)\\\bottomrule
  \end{tabular}
\end{center}
Example: image /.rockbox/bg.bmp with ID "a" at 37, 109 would be: \%x{\textbar}a{\textbar}bg.bmp{\textbar}37{\textbar}109{\textbar}

\begin{itemize}
\item \textbf{Note:} The images must be in a rockbox compatible format (1 bit per pixel BMP)
\item \textbf{Note:} The image tag must be on its own line
\item \textbf{Note:} The ID is case sensitive, giving 52 different ID's
\item \textbf{Note:} The size of the LCD screen for each player varies. See table below for appropriate sizes of each device. The x and y coordinates must repect each of the players' limits.
\end{itemize}

\subsubsection{LCD Screen Sizes}
\begin{center}
  \begin{tabular}{@{}lll@{}}\toprule
    \textbf{Player} & \textbf{Main LCD Size} & \textbf{Remote LCD Size}\\\midrule
    iRiver H1x0 & 160x128 & 128x64\\
    iRiver H3x0 & 220x176 & 128x64\\
    Archos Recorders & 112x64 & \\ 
    Archos Ondio & 112x64 & \\
    iPod Nano & 176x132 & \\
    iPod 4G Color & 220x176 & \\
    iPod 5G Video & 320x240 & \\
    iAudio X5 & 160x128 & \\\bottomrule
  \end{tabular}
\end{center}

\subsubsection{Alignment}
\begin{center}
  \begin{tabular}{@{}lll@{}}\toprule
    \textbf{Tag} & \textbf{Description}\\\midrule
    \%al & Text is left aligned\\
    \%ac & Text is center aligned\\
    \%ar & Text is right aligned\\\bottomrule
  \end{tabular}
\end{center}
All alignment tags may be present in one line, but they need to be in the order left - center - right. If the aligned texts overlap, they are merged.

\subsubsection{Conditional Tags}
\textbf{If/else}\\
\newline
Syntax: \%?xx{\textless}true{\textbar}false{\textgreater}\\

If the tag specified by ``xx'' has a value, the text between the ``{\textless}'' and the ``{\textbar}'' is displayed (the true part), else the text between the ``{\textbar}'' and the ``{\textgreater}'' is displayed (the false part).
The else part is optional, so the ``{\textbar}'' does not have to be specified if no else part is desired. The conditionals nest, so the text in the if and else part can contain all \% commands, including conditionals.
\newline
\textbf{Enumerations}\\
\newline
Syntax: \%?xx{\textless}alt1{\textbar}alt2{\textbar}alt3{\textbar}...{\textbar}else{\textgreater}

For tags with multiple values, like Play status, the conditional can hold a list of alternatives, one for each value the tag can have.

Example: \%?mp{\textless}Stop{\textbar}Play{\textbar}Pause{\textbar}Ffwd{\textbar}Rew{\textgreater}

The last else part is optional, and will be displayed if the tag has no value. The WPS parser will always display the last part if the tag has no value, or if the list of alternatives is too short. 

\subsubsection{Next Song info}
You can display information about the next song {}- the song that is
about to play after the one currently playing (unless you change the
plan).

If you use the upper{}-case versions of the
three tags: F, I and D, they will instead refer to the next song
instead of the current one. Example: \%Ig is the genre name used in the
next song and \%Ff is the mp3 frequency. 

Take note that the next song information WILL NOT be available at all
times, but will most likely be available at the end of a song. We
suggest you use the conditional display tag a lot when displaying
information about the next song! 

\subsubsection{Alternating sublines}

It is possible to group items on each line into 2 or more groups or
``sublines''. Each subline will be displayed
in succession on the line for a specified time, alternating
continuously through each defined subline. 

Items on a line are broken into sublines with the semicolon
';' character. The display time for
each subline defaults to 2 seconds unless modified by using the
'\%t' tag to specify an alternate
time (in seconds and optional tenths of a second) for the subline to be
displayed. 

Subline related special characters and tags: 

;  : Split items on a line into separate sublines

\%t  : Set the subline display time. The
'\%t' is followed by either integer
seconds (\%t5), or seconds and tenths of a second (\%t3.5).

Each alternating subline can still be optionally scrolled while it is
being displayed, and scrollable formats can be displayed on the same
line with non{}-scrollable formats (such as track elapsed time) as long
as they are separated into different sublines.

Example subline definition:

\begin{verbatim}
  %s%t4%ia;%s%it;%t3%pc %pr :          Display id3 artist for 4 seconds,
                                       Display id3 title for 2 seconds,
                                       Display current and remaining track time
                                       for 3 seconds,
                                       repeat...
\end{verbatim}

Conditionals can be used with sublines to display a different set and/or number of sublines on the line depending on the evaluation of the conditional.

Example subline with conditionals:

\%?it{\textless}\%t8\%s\%it{\textbar}\%s\%fn{\textgreater};\%?ia{\textless}\%t3\%s\%ia{\textbar}\%t0{\textgreater}\\

The format above will do two different things depending if ID3 tags are present. If the ID3 artist and title are present :

Display id3 title for 8 seconds,\\

Display id3 artist for 3 seconds,\\

repeat...\\

If the ID3 artist and title are not present :\\

Display the filename continuously.\\

Note that by using a subline display time of 0 in one branch of a conditional, a subline can be skipped (not displayed) when that condition is met. 

\subsubsection{Other Tags}
\begin{verbatim}
  %%  : Display a '%'
  %<  : Display a '<'
  %|  : Display a '|'
  %>  : Display a '>'
  %;  : Display a ';'
  %s  : Indicate that the line should scroll. Can occur anywhere in
        a line (given that the text is displayed; see conditionals
        above). You can specify up to 10 scrolling lines.
        Scrolling lines can not contain dynamic content such as timers,
        peak meters or progress bars.
\end{verbatim}

\subsubsection{Using Images}
You can have as many as 52 images in your WPS. There are two ways of displaying images:
\begin{enumerate}
  \item Load and always show the image, using the \%x tag
  \item Preload the image with \%xl and show it with \%xd. This way you can have your images displayed conditionally.
  \item Load an image and show as backdrop using the \%X tag. The image must be of the same exact dimensions as your display. (Currently only supported on color targets).
\end{enumerate}
Example:
\begin{verbatim}
%X|background.bmp|
%x|a|static_icon.bmp|50|50|
%xl|b|rep_off.bmp|16|64|
%xl|c|rep_all.bmp|16|64|
%xl|d|rep_one.bmp|16|64|
%xl|e|rep_shuffle.bmp|16|64|
%?mm<%xdb|%xdc|%xdd|%xde>
\end{verbatim}
This example loads and displays a background image, and preloads four other images at the same x and y position. Which image to display is determined by the \%mm tag (the repeat mode).

\subsubsection{Example File}
\begin{verbatim}
%s%?in<%in - >%?it<%it|%fn> %?ia<[%ia%?id<, %id>]>
%pb%pc/%pt
\end{verbatim}
That is, "tracknum - title [artist, album]", where most fields are only displayed if available. Could also be rendered as "filename" or "tracknum - title [artist]".

\subsubsection{Default}
If you haven't selected a .wps file in the /.rockbox
directory, you get the hard coded layout. The default WPS screen is:
\opt{player}{
%\begin{verbatim}
  %s%pp/%pe: %?it<%it|%fn> - %?ia<%ia|%d2> - %?id<%id|%d1>
  %pc%?ps<*|/>%pt
%\end{verbatim}
}

\opt{recorder,recorderv2fm,h1xx,h300,ipodcolor,ipodnano}{
%  \begin{verbatim}
    %s%?it<%?in<%in. |>%it|%fn>
    %s%?ia<%ia|%?d2<%d2|(root)>>
    %s%?id<%id|%?d1<%d1|(root)>> %?iy<(%iy)|>
  
    %al%pc/%pt%ar[%pp:%pe]
    %fbkBit %?fv<avg|> %?iv<(id3v%iv)|(no id3)>
    %pb
    %pm
 % \end{verbatim}
}

\section{\label{ref:SettingsFile}Making your own settings file}
A .cfg file is used to load settings from a plain text file. A .cfg file
may reside anywhere on the hard disk. The only restriction is that the
filename must end in .cfg

Hint: Use the ``Write .cfg file'' feature (Main Menu{}-{\textgreater} General Settings) to save the current settings, then use a text editor to customize the settings file.

\subsection{Format Rules}

\begin{itemize}
\item Format: \verb+setting: value+
\item Each setting must be on a separate line.
\item Lines starting with \# are ignored.
\end{itemize}

\subsection{General Settings}
\begin{center}
  \begin{tabular}{@{}lll@{}}\toprule
    \textbf{Setting} & \textbf{Allowed Values} & \textbf{Unit}\\\midrule
     volume & 0 to 100 & \%\\
     bass & -15 to +15 & dB\\
     treble & -15 to +15 &dB\\
     balance & -100 to +100 & \%\\
     channels & stereo, stereo narrow, stereo wide, & N/A\\
              & mono, mono left, mono right, karaoke & \\
     shuffle & on, off & N/A\\
     repeat & off, all, one & N/A\\
     play selected & on, off & N/A\\
     resume & off, ask, ask once, on & N/A\\
     scan min step & 1, 2, 3, 4, 5, 6, 8, 10, 15, 20, 25, 30, 45, 60 & seconds\\
     scan accel & 0 to 15 & seconds\\
     antiskip & 0 to 7 & seconds\\
     volume fade & on, off & N/A\\
     id3 tag priority & v2-v1, v1-v2 & N/A\\
     sort case & on, off & N/A\\
     show files & all, supported, music, playlists & N/A\\
     follow playlist & on, off & N/A\\
     playlist viewer icons & off,on & N/A\\
     playlist viewer indices & off,on & N/A\\
     playlist viewer track display & track name,full path & N/A\\
     recursive directory insert & off,on & N/A\\
     scroll speed & 1 to 25 & Hz\\
     scroll delay & 0 to 250 & 1/10s\\
     scroll step & 1 to 112 & pixels\\
     bidir limit & 0 to 200 & \% of screen width\\
     contrast & 0 to 63 & N/A\\
     backlight timeout & off, on, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, & seconds\\ 
                       & 15, 20, 25, 30, 45, 60, 90 & \\
     backlight when plugged & on, off & N/A\\
     disk spindown & 3 to 254 & seconds\\
     battery capacity & 1500 - 3200 & mAh\\
     idle poweroff & off, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, & minutes\\
                   & 15, 30, 45, 60 & \\
     lang & /path/filename.lng & N/A\\
     wps & /path/filename.wps & N/A\\
     autocreate bookmarks & off,on & N/A\\
     autoload bookmarks & off,on & N/A\\
     use most-recent-bookmarks & off,on & N/A\\
     talk dir & off,number,spell,enter.hover & N/A\\
     talk file & off,number,spell & N/A\\
     talk menu & off,on & N/A\\\bottomrule
  \end{tabular}
\end{center}

\subsection{Recorder{}-specific settings}
\begin{center}
  \begin{tabular}{@{}lll@{}}\toprule
    \textbf{Setting} & \textbf{Allowed Values} & \textbf{Unit}\\\midrule
     loudness & 0 to 17 & N/A\\
     super bass & on,off & N/A\\
     auto volume & off, 20ms, 2s, 4s, 8s & seconds\\
     MDB enable & on,off & N/A\\
     MDB strength & 0 to 127 & dB\\
     MDB harmonics & 0 to 100 & \%\\
     MDB center frequency & 20 to 300 & Hz\\
     MDB shape & 50 to 300 & Hz\\
     peak meter release & 1 to 126 & ?\\
     peak meter hold & off, 200ms, 300ms, 500ms, & N/A \\
                     & 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 15, 20, 30, 1min & \\
     peak meter clip hold & on, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,& N/A \\
                     & 15, 20, 25, 30, 45, 60, 90, 2min, 3min, 5min, &\\
                     & 10min, 20min, 45min, 90min & \\
     peak meter busy & on, off & N/A\\
     peak meter dbfs & on, off & on = dbfs,\\
                     &         & off = linear\\
     peak meter min  & 0 to 89 (dB) or 0 to 100 (\%) & dB or \%\\
     peak meter max  & 0 to 89 /dB) or 0 to 100 (\%) & dB or \%\\
     statusbar & on, off & N/A\\
     scrollbar & on, off & N/A\\
     volume display & graphic, numeric & N/A\\
     battery display & graphic, numeric & N/A\\
     time format & 12hour, 24hour & N/A\\
     font & /path/filename.fnt & N/A\\
     invert & on, off & N/A\\
     deep discharge & on, off & N/A\\
     trickle charge & on, off & N/A\\
     disk poweroff & on, off & N/A\\
     rec quality & 0 to 7 & 0=smallest size, 7=highest quality\\
     rec frequency & 48, 44, 32, 24, 22, 16 & kHz\\
     rec source & mic, line, spdif & N/A\\
     rec channels & mono, stereo & N/A\\
     rec mic gain & 0 to 15 & N/A\\
     rec left gain & 0 to 15 & N/A\\
     rec right gain & 0 to 15 & N/A\\
     editable recordings & off,on & N/A\\
     rec timesplit & off, 0:05, 0:10, 0:15, 0:30, 1:00, & h:mm\\
                   & 2:00, 4:00, 6:00, 8:00, 16:00, 24:00 & \\
     pre-recording time & off, 1 to 30 & s\\
     rec directory & /recordings,current & N/A\\\bottomrule
    \end{tabular}
\end{center}

\subsection{FM recorder specific settings}
\begin{center}
  \begin{tabular}{@{}lll@{}}\toprule
    \textbf{Setting} & \textbf{Allowed Values} & \textbf{Unit}\\\midrule
    Force FM mono & off,on & N/A\\\bottomrule
  \end{tabular}
\end{center}

\subsection{Example File}
\begin{verbatim}
  volume: 70
  
  bass: 11

  treble: 12
  
  balance: 0
  
  time format: 12hour

  volume display: numeric

  show files: supported
  
  wps: /.rockbox/car.wps
  
  lang: /.rockbox/afrikaans.lng
\end{verbatim}

\section{\label{ref:PartISection1}Differences between binaries}
There are 3 different types of firmware binaries from Rockbox website. Current Version, Daily Builds and Bleeding Edge.

\begin{itemize}
\item \begin{itemize}
\item The current version is the latest stable version developed by the
Rockbox Team. It's free of known critical bugs and works with Archos
Jukebox Player/Studio, Recorders and Ondio devices.  It is available
from 
\url{http://www.rockbox.org/download/}.
\item The Daily Build is a development version of Rockbox. It supports all new features and patches developed since last stable version. It may also contain bugs! This version is generated automatically every day and can be found at
\url{http://www.rockbox.org/daily.shtml}.
\item Bleeding edge builds are the same as the Daily build, but built
from the latest development code every 20 minutes. These builds are for
people who want to test the code that developers just checked in.
\end{itemize}
\end{itemize}
There are binaries for different Jukebox models: 

\begin{itemize}
\item \begin{itemize}
\item The Player version is suitable for Archos Jukebox 5000, 6000 and
all Studio models.
\end{itemize}
\end{itemize}
\begin{itemize}
\item \begin{itemize}
\item If you have a recorder with cylindrically rounded bumpers, you
need the ``regular'' recorder version. 
\item FM Recorders are models with a FM radio.
\item The V2 recorder is a recorder in an FM Recorder form factor, but
without radio. 
\item The 8mb version requires a hardware hack, where the RAM chips are
replaced. 
\item  The Ondio builds come with and without radio support, for the
Ondio FM and SP respectively.
\end{itemize}
\end{itemize}
If in doubt as to which version to use, the table on page
\pageref{ref:Jukeboxtypetable} may be of assistance.

Note: All references in this manual to
``Recorder'' apply equally to the FM Recorder
unless otherwise specified.

\section{\label{ref:FirmwareLoading}Firmware Loading}
When your Jukebox powers on, it loads the Archos firmware in ROM, which
automatically checks your Jukebox hard disk's root folder for a file
named \textbf{archos.mod} (on the player version) or
\textbf{ajbrec.ajz} (on the recorder version). Note that Archos
firmware can only read the first ten characters of each file name in
this process, so don't rename your old firmware files with names like
archos.mod.old and so on, because it's possible that the Jukebox will
load a file other than the one you intended.

\section{\label{ref:PartISection4}Using ROLO (Rockbox loader)}
Rockbox is able to load and start another firmware file without
rebooting. You just press PLAY on an .ajz (Recorder, Ondio) or .mod
(Player) file. This can be used to test new firmware versions without
deleting your current version, or to load the original Archos firmware
(you have to download the appropriate file from
Archos' website). 

\section{\label{ref:Rockboxinflash}Rockbox in flash (Recorder, Ondio)}
\textbf{FLASHING ROCKBOX IS OPTIONAL!} It is not required for using
Rockbox on your Jukebox Recorder. Please read the whole section
thoroughly before flashing.

\subsection{\label{ref:PartISection61}Introduction}
Flashing in the sense used here and elsewhere in regard to Rockbox means
reprogramming the flash memory of the Jukebox unit. Flash memory
(sometimes called ``Flash ROM'') is a type of
non{}-volatile memory that can be erased and reprogrammed in circuit. It is a variation of electrically erasable
programmable read{}-only memory (EEPROM). 

A from the factory Jukebox comes with the Archos firmware flashed. It is
possible to replace the built{}-in software with Rockbox. 

Terminology used in the following:\newline
\textbf{Firmware} means the flash ROM content as a whole.\newline
\textbf{Image} means one operating software started from there. 

By reprogramming the firmware,  the Jukebox will boot much faster. The
Archos boot loader seems to take forever compared to the Rockbox
version. In fact, the Rockbox boot loader is so fast that it has to
wait for the disk to spin up.  The flashing procedure is a bit involved
for the first time, updates are very simple later on. 

\subsection{\label{ref:Method}Method}
The replaced firmware will host a bootloader and 2 images. This is made
possible by compression. The first is the
``permanent'' backup. The second is the
default image to be started.  The former is only used when you hold the
F1 key during start, and is the original Archos firmware, the second is
a current build of Rockbox. This second image is meant to be
reprogrammed whenever a Rockbox upgrade is performed.

There are two programming tools supplied: 

\begin{itemize}
\item The first one is called \textbf{firmware\_flash.rock} and is used
to program the whole flash with new content.  It can also be used to
revert back to the original firmware that is backed up as part of this
procedure.  This tool will only be needed once, and can be viewed as
``formatting'' the flash with the desired image structure. 
\item The second one is called \textbf{rockbox\_flash.rock }and is used
to reprogram only the second image. If the resulting programmed
firmware image is not operational, it is
possible to hold down the F1 key while booting to start the Jukebox
with the Archos firmware and Rockbox booted from disk to reinstall a
working firmware image. 
\end{itemize}

\subsubsection{\label{ref:PartISection63}Risks}
Well, is it dangerous? Yes, certainly, like programming a
mainboard BIOS, CD/DVD drive firmware,
mobile phone, etc. If the power fails, the chip malfunctions while
programming or particularly if the programming software malfunctions,
your Jukebox may stop functioning. The Rockbox team take no
responsibility of any kind {}- do this at your own risk. 

However, the code has been extensively tested and is known to work well.
 The new firmware file is completely read before it starts programming,
there are a lot of sanity checks. If any fail, it will not program.
There is no reason why such low level code should behave differently on
your Jukebox. 

There's one ultimate safety net to bring back Jukeboxes
with even completely garbled flash content: the UART boot mod, which in
turn requires the serial mod. This can bring the dead back to life,
with that it's possible to reflash independently from the outside, even
if the flash is completely erased. It has been used during development,
else Rockbox in flash wouldn't have been possible.
Extensive development effort went into the development of the UART boot
mod.  Mechanically adept users with good soldering skills can easily
perform these mods. Others may feel uncomfortable using the first tool
(\textbf{firmware\_flash.rock}) for reflashing the firmware.

If you are starting with a known{}-good image, you are unlikely to
experience problems.  The flash tools have been stable for quite a
while. Several users have used them extensively, even flashing while
playing! Although it worked, it's not the recommended
method.  

The flashing software is very paranoid about making sure that the
correct flash version is being installed.  If the wrong file is used,
it will simply refuse to flash the Jukebox.

About the safety of operation: Since the Rockbox boot code gives ``dual
boot'' capability, the Archos firmware is still there when you hold F1
during startup. So even if you have problems with Rockbox from flash, you can still use
the Jukebox, reflash the second image with an updated Rockbox copy,
etc. 

The flash chip being used by Archos is specified for 100,000 cycles, so
it's very unlikely that flashing it will wear it out. 

\subsection{\label{ref:Requirements}Requirements}
You need two things: 

\begin{itemize}
\item The first is a Recorder or FM model, or an Ondio SP or FM. Be sure
you're using the correct package, they differ
depending on your precise hardware! The technology works for the Player
models, too. Players can also be flashed, but Rockbox does not run
cold{}-started on those, yet. 
\item Second, you need an in{}-circuit programmable flash. Chances are
about 85\% that you have, but Archos also used an older flash chip
which can't do the trick. You can find out via Rockbox
debug menu, entry Hardware Info. If the flash info gives you question
marks, you're out of luck. The only option for
flashing if this is the case is to solder in the right chip
(SST39VF020), preferably with the firmware already in. If the chip is
blank, you'll need the UART boot mod as well. 
\end{itemize}
\subsubsection{\label{ref:FlashingProcedure}Flashing Procedure}
Here are step{}-by{}-step instructions on how to flash and update to a
current build.  It is assumed that you can install and operate Rockbox
the usual way. The flashing procedure has a lot of failsafes, and will
check for correct model, file, etc. {}- if something is incompatible it
just won't flash, that's all. 

Now here are the steps: 

\textbf{Preparation}

Install (with all the files, not just the .ajz) and use the current
daily build you'd like to have. Enable any voice
features that are helpful throughout the process, such as menus and
filename spelling. Set the file view to show all files, with  the menu
option \textbf{General Settings {}-{\textgreater} File View
{}-{\textgreater} Show Files} set to ``all''.
Have the Jukebox nicely charged to avoid
running out of power during the flash write.  Keep the Jukebox plugged
into the charger until flashing is complete.

{\bfseries
Backup }

Backup the existing flash content.  This is not an essential part of the
procedure, but is strongly recommended since you will need these files
if you wish to reverse the flashing procedure, or if you need to update
the bootloader (as opposed to the firmware) in the future.  Keep them
safe!

Access the main menu by pressing F1 then select \textbf{Info
{}-{\textgreater} Debug}.  Select the first entry, \textbf{Dump ROM
contents}, by pressing Play one more time. The disk should start to
spin. Wait for it to settle down, then plug in the USB cable  to copy
the dump file this has just been created to your PC. The main folder of
your Jukebox now should contain two strange .bin files. Copy the larger
one named
\textbf{internal\_rom\_2000000{}-203FFFF.bin}
to a safe place, then delete them both from the box. 

{\bfseries
Copy the new flash content file to your box }

Depending on your model (recorder, FM, V2 recorder), download one of the
3 packages: 

\url{http://joerg.hohensohn.bei.t-online.de/archos/flash/flash_rec.zip}

\url{http://joerg.hohensohn.bei.t-online.de/archos/flash/flash_fm.zip}

\url{http://joerg.hohensohn.bei.t-online.de/archos/flash/flash_v2.zip}
\url{http://joerg.hohensohn.bei.t-online.de/archos/flash/flash_v2.zip}

\url{http://joerg.hohensohn.bei.t-online.de/archos/flash/flash_v2.zip}

\url{http://joerg.hohensohn.bei.t-online.de/archos/flash/flash_ondiosp.zip}

\url{http://joerg.hohensohn.bei.t-online.de/archos/flash/flash_ondiofm.zip}

The zip archives contain two .bin files each. Those firmware*.bin files
are all we want, copy them to the root directory of your box. The names
differ depending on the model, the flash
plugin will pick the right one, no way of
doing this wrong. 

{\bfseries
Install the Rockbox
Bootloader (``formatting'' the flash)}

This procedure is only necessary the first time you flash Rockbox. 
Unplug the USB cable again, then select \textbf{Browse
}\textbf{Plugins}\textbf{ } from the main menu (F1).  Locate \textbf{firmware\_flash.rock}, and start it with PLAY.  Rockbox now displays an info screen, press F1 to acknowledge it and start a file check. Again wait for the disk to
settle, then press F2 to proceed to a warning message (if the plugin
has exited, you don't have the proper file) and F3 to actually program
the file. This takes maybe 15 seconds, wait for the disk to settle
again. Then press a key to exit the plugin.

{\centering\itshape
  [Warning: Image ignored] % Unhandled or unsupported graphics:
%\includegraphics[width=3.609cm,height=2.062cm]{images/rockbox-manual-img75.png}
     [Warning: Image ignored] % Unhandled or unsupported graphics:
%\includegraphics[width=3.669cm,height=2.097cm]{images/rockbox-manual-img76.png}
 \textmd{  }  [Warning: Image ignored]
% Unhandled or unsupported graphics:
%\includegraphics[width=3.739cm,height=2.136cm]{images/rockbox-manual-img77.png}
 \newline
Flashing boot loader in 3 easy steps
\par}

{\bfseries
\label{ref:FlashingRockbox}Install the Rockbox binary in flash}

All the above was necessary only once, although there will not be any
obvious difference (other than the Archos firmware loading a bit more quickly)
after the step above is complete.  Next install the actual Rockbox firmware thatwill be used from ROM.  This is how Rockbox will be updated when
installing a new release from now on. 

\begin{itemize}
\item Unpack the whole build that you are installing onto the Jukebox,
including plugins and support files.  This can be done using the Windows setup program to install the new version onto the Jukebox.
\item Test the build you are going to flash by playing the .ajz file so
that ROLO loads it up.  This puts the firmware in memory without
changing your flash, so you can check that everything is working.  If
you have just installed the bootloader (see above) then this will happen automatically as the existing Archos firmware loads the .ajz that you have just installed.  If upgrading ROMbox, this step \textbf{must }be carried out since Rockbox cannot overwrite the ROM while it is running from it.  
\item Play the .ucl file, which is usually found in the
\textbf{/.rockbox} directory, this will kick off the
\textbf{rockbox\_flash.rock} plugin. It's a bit
similar to the other one, but it's made different to
make the user aware. It will check the file, available size, etc. With
F2 it begins programming, there is no need for warning this time. If it
goes wrong, you'll still have the permanent image. 

{\centering\itshape
  [Warning: Image ignored] % Unhandled or unsupported graphics:
%\includegraphics[width=3.53cm,height=2.016cm]{images/rockbox-manual-img78.png}
 \textmd{  }  [Warning: Image ignored]
% Unhandled or unsupported graphics:
%\includegraphics[width=3.528cm,height=2.016cm]{images/rockbox-manual-img79.png}
 \newline
Using rockbox\_flash to update your boot firmware
\par}
\item It is possible that you could get an ``Incompatible
Version'' error if the plugin interface has changed since
you last flashed Rockbox. This means you are running an
``old'' copy of Rockbox, but are trying to
execute a newer plugin, the one you just downloaded. The easiest
solution is to ROLO into this new version,
by playing the\textbf{ ajbrec.ajz }file. Then you are consistent and can play
\textbf{rockbox.ucl}. 
\item When done, you can restart the box and hopefully your new Rockbox
image. 
\end{itemize}
UCLs for the latest Recorder and FM firmware are included in Rockbox 2.4
and also the daily builds.

\subsection{\label{ref:KnownIssuesAndLimits}Known Issues and Limitations}
There are two variants as to how the Jukebox starts, which is why there
are normal and \_norom firmware files. The vast majority of Jukeboxes
all have the same boot ROM content, but some have different flash
content. Rockbox identifies this boot ROM with a CRC value of 0x222F in
the hardware info screen. Some recorders have the boot ROM disabled (it
might be unprogrammed) and start directly from a flash mirror at
address zero. They need the \_norom firmware, it has a slightly
different bootloader. Without a boot ROM there is no UART boot safety
net. To compensate for that as much as possible the MiniMon monitor is
included, and can be started by pressing  F3+ON. Using this the box can
be reprogrammed via serial if the UART mod has been applied and the
first \~{}2000 bytes of the flash are OK. 

\subsubsection{ROMbox}
ROMbox is a flashable version of Rockbox that is
uncompressed and runs directly from the flash chip rather than being
copied into memory first.  The advantage of this is that memory that
would normally be used for storing the Rockbox code can be used for
buffering MP3s instead, resulting in less disk
spin{}-ups and therefore longer battery life
 Unfortunately being uncompressed, ROMbox requires more space in flash
than Rockbox and will therefore not fit in the space that is left on an
FM recorder.  ROMbox therefore runs on the V1 and V2 recorder models
only.

The procedure for flashing ROMbox is identical to the procedure for
flashing Rockbox as laid out on page \pageref{ref:FlashingRockbox}. 
The only difference is that the file to install is called
\textbf{rombox.ucl}.  ROMbox is included automatically with rockbox 2.4
and all the current daily builds, so the procedure is identical
otherwise.

