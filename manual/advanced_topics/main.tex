\chapter{Advanced Topics}

\section{\label{ref:CustomisingUI}Customising the userinterface}
\subsection{\label{ref:GettingExtras}Getting Extras (Fonts,Languages)}
Rockbox supports custom fonts (for the Recorder and Ondio only) and a number of different languages. Rockbox comes with several fonts and languages already included. If new fonts and language files have been created, then they will be found at \url{http://www.rockbox.org/fonts/} and \url{http://www.rockbox.org/lang/}.

\subsection{\label{ref:Loadingfonts}Loading Fonts (Recorder, Ondio)}
Rockbox can load fonts dynamically. Simply copy the .fnt file to the \dap\ and ``play'' them in the directory browser or select \textbf{General Settings {\textgreater} Fonts} from the Main Menu .

If you want a font to be loaded automatically every time you start up,
it must be located in the \fname{/.rockbox }folder and the file name
must be at most 24 characters long.

Any BDF font file up to 16 pixels high should be usable with Rockbox. To
convert from .bdf to .fnt, use the \fname{convbdf} tool. This tool can be found in the tools directory of the Rockbox source code.

\subsection{\label{ref:Loadinglanguages}Loading Languages}
Rockbox can load language files at runtime. Simply copy the .lng file (do not use the .lang file) to the \dap\ and ``play'' it in the Rockbox directory browser or select \textbf{General Settings {}-{\textgreater} Languages }from the Main Menu.

If you want a language to be loaded automatically every time you start up, it must be located in the \fname{/.rockbox }folder and the file name must be a maximum of 24 characters long.

Rockbox supports many different languages. You can get .lng files at \url{http://www.rockbox.org/lang/}.
Currently all of these languages are included in the Rockbox
distribution.

If your language is not yet supported and you want to write your own language file,  follow these instructions:

\begin{itemize}
\item Copy the\url{./ http://www.rockbox.org/lang/english.lang} file and start filling in the ``new:'' lines.
\item Name your file \fname{{\textless}language{\textgreater}.lang}, where
\fname{{\textless}language{\textgreater}} is the local name for your language. i.e. \fname{svenska.lang}, \fname{francais.lang} etc.
\item When you are done, submit your .lang file to Rockbox patch tracker.\\
  (\url{http://www.rockbox.org/bugs/index.php?type=4})
\end{itemize}

\section{\label{ref:ConfiguringtheWPS}Configuring the WPS}

\subsection{Description / General Info}

\begin{itemize}
\item The Custom While Playing Screen (WPS) display is used as a means to customise the WPS to the user's likings.
\item After editing the .wps file, ``play'' it to make it take effect.
\item All characters not preceded by \% are displayed as typed.
\item Lines beginning with \# are comments and will be ignored.
\item Maximum file size used is \opt{recorder,recorderv2fm,ondio,h1xx,h300,ipodcolor,ipodnano}{1600}\opt{player}{400} bytes. If you have a bigger WPS file, only the first part of it will be loaded and used.
\end{itemize}

\subsection{File Location}
Custom WPS files may be located anywhere on the drive. The only restriction is that they must end in .wps. When you ``play'' a .wps file, it will be used for future WPS screens. If the ``played'' .wps file is located in the \fname{/.rockbox} folder, it will be remembered and used after reboot. The .wps filename must be no more than 24 characters long for it to be remembered.

\subsection{How To Create A .wps File}
Quite simply, enter the WPS code in your favourite text editor, Notepad on Windows works fine. When you save it, instead of saving it as a .txt file, save it as a .wps file. Example: Instead of \fname{Rockbox.txt}, save the file as \fname{Rockbox.wps}. To make sure non english characters display correctly in your WPS you must save the .wps file with UTF-8 character encoding. This can be done in most editors, for example Notepad in Windows 2000 or XP (but not in 9x/ME) can do this. See appendix \ref{ref:wps_tags} for all the tags that are available.

\subsubsection{Conditional Tags}

\textbf{If/else}\\

Syntax: \%?xx{\textless}true{\textbar}false{\textgreater}\\

If the tag specified by ``xx'' has a value, the text between the ``{\textless}'' and the ``{\textbar}'' is displayed (the true part), else the text between the ``{\textbar}'' and the ``{\textgreater}'' is displayed (the false part).
The else part is optional, so the ``{\textbar}'' does not have to be specified if no else part is desired. The conditionals nest, so the text in the if and else part can contain all \% commands, including conditionals.

\textbf{Enumerations}\\

Syntax: \%?xx{\textless}alt1{\textbar}alt2{\textbar}alt3{\textbar}...{\textbar}else{\textgreater}\\

For tags with multiple values, like Play status, the conditional can hold a list of alternatives, one for each value the tag can have.

Example: \%?mp{\textless}Stop{\textbar}Play{\textbar}Pause{\textbar}Ffwd{\textbar}Rew{\textgreater}\\

The last else part is optional, and will be displayed if the tag has no value. The WPS parser will always display the last part if the tag has no value, or if the list of alternatives is too short. 

\subsubsection{Next Song info}
You can display information about the next song {}- the song that is
about to play after the one currently playing (unless you change the
plan).

If you use the upper{}-case versions of the
three tags: F, I and D, they will instead refer to the next song
instead of the current one. Example: \%Ig is the genre name used in the
next song and \%Ff is the mp3 frequency. 

Take note that the next song information WILL NOT be available at all
times, but will most likely be available at the end of a song. We
suggest you use the conditional display tag a lot when displaying
information about the next song! 

\subsubsection{Alternating sublines}

It is possible to group items on each line into 2 or more groups or
``sublines''. Each subline will be displayed
in succession on the line for a specified time, alternating
continuously through each defined subline. 

Items on a line are broken into sublines with the semicolon
';' character. The display time for
each subline defaults to 2 seconds unless modified by using the
'\%t' tag to specify an alternate
time (in seconds and optional tenths of a second) for the subline to be
displayed. 

Subline related special characters and tags: 

;  : Split items on a line into separate sublines

\%t  : Set the subline display time. The
'\%t' is followed by either integer
seconds (\%t5), or seconds and tenths of a second (\%t3.5).

Each alternating subline can still be optionally scrolled while it is
being displayed, and scrollable formats can be displayed on the same
line with non{}-scrollable formats (such as track elapsed time) as long
as they are separated into different sublines.

Example subline definition:

\begin{verbatim}
  %s%t4%ia;%s%it;%t3%pc %pr : Display id3 artist for 4 seconds,
                              Display id3 title for 2 seconds,
                              Display current and remaining track time
                              for 3 seconds,
                              repeat...
\end{verbatim}

Conditionals can be used with sublines to display a different set and/or number of sublines on the line depending on the evaluation of the conditional.

Example subline with conditionals:

\%?it{\textless}\%t8\%s\%it{\textbar}\%s\%fn{\textgreater};\%?ia{\textless}\%t3\%s\%ia{\textbar}\%t0{\textgreater}\\

The format above will do two different things depending if ID3 tags are present. If the ID3 artist and title are present :

Display id3 title for 8 seconds,\\

Display id3 artist for 3 seconds,\\

repeat...\\

If the ID3 artist and title are not present :\\

Display the filename continuously.\\

Note that by using a subline display time of 0 in one branch of a conditional, a subline can be skipped (not displayed) when that condition is met. 


\subsubsection{Using Images}
You can have as many as 52 images in your WPS. There are two ways of displaying images:
\begin{enumerate}
  \item Load and always show the image, using the \%x tag
  \item Preload the image with \%xl and show it with \%xd. This way you can have your images displayed conditionally.
  \item Load an image and show as backdrop using the \%X tag. The image must be of the same exact dimensions as your display. (Currently only supported on color targets).
\end{enumerate}
Example:
\begin{verbatim}
%X|background.bmp|
%x|a|static_icon.bmp|50|50|
%xl|b|rep_off.bmp|16|64|
%xl|c|rep_all.bmp|16|64|
%xl|d|rep_one.bmp|16|64|
%xl|e|rep_shuffle.bmp|16|64|
%?mm<%xdb|%xdc|%xdd|%xde>
\end{verbatim}
This example loads and displays a background image, and preloads four other images at the same x and y position. Which image to display is determined by the \%mm tag (the repeat mode).

\subsubsection{Example File}
\begin{verbatim}
%s%?in<%in - >%?it<%it|%fn> %?ia<[%ia%?id<, %id>]>
%pb%pc/%pt
\end{verbatim}
That is, "tracknum - title [artist, album]", where most fields are only displayed if available. Could also be rendered as "filename" or "tracknum - title [artist]".

\subsubsection{Default}
If you haven't selected a .wps file in the \fname{/.rockbox} directory, you get the hard coded layout. The default WPS screen is:
\opt{player}{
%\begin{verbatim}
  %s%pp/%pe: %?it<%it|%fn> - %?ia<%ia|%d2> - %?id<%id|%d1>
  %pc%?ps<*|/>%pt
%\end{verbatim}
}

\opt{recorder,recorderv2fm,h1xx,h300,ipodcolor,ipodnano}{
%  \begin{verbatim}
    %s%?it<%?in<%in. |>%it|%fn>
    %s%?ia<%ia|%?d2<%d2|(root)>>
    %s%?id<%id|%?d1<%d1|(root)>> %?iy<(%iy)|>
  
    %al%pc/%pt%ar[%pp:%pe]
    %fbkBit %?fv<avg|> %?iv<(id3v%iv)|(no id3)>
    %pb
    %pm
 % \end{verbatim}
}

\section{\label{ref:SettingsFile}Making your own settings file}
A .cfg file is used to load settings from a plain text file. A .cfg file
may reside anywhere on the hard disk. The only restriction is that the
filename must end in .cfg

Hint: Use the ``Write .cfg file'' feature \textbf({Main Menu{}-{\textgreater} General Settings}) to save the current settings, then use a text editor to customize the settings file.

\subsection{Format Rules}

\begin{itemize}
\item Format: \verb+setting: value+
\item Each setting must be on a separate line.
\item Lines starting with \# are ignored.
\end{itemize}

\subsection{General Settings}
\begin{center}
  \begin{longtable}{@{}lll@{}}\toprule
    \textbf{Setting} & \textbf{Allowed Values} & \textbf{Unit}\\\midrule
     volume & 0 to 100 & \%\\
     bass & -15 to +15 & dB\\
     treble & -15 to +15 &dB\\
     balance & -100 to +100 & \%\\
     channels & stereo, stereo narrow, stereo wide, & N/A\\
              & mono, mono left, mono right, karaoke & \\
     shuffle & on, off & N/A\\
     repeat & off, all, one & N/A\\
     play selected & on, off & N/A\\
     resume & off, ask, ask once, on & N/A\\
     scan min step & 1, 2, 3, 4, 5, 6, 8, 10, 15, 20, 25, 30, 45, 60 & seconds\\
     scan accel & 0 to 15 & seconds\\
     antiskip & 0 to 7 & seconds\\
     volume fade & on, off & N/A\\
     id3 tag priority & v2-v1, v1-v2 & N/A\\
     sort case & on, off & N/A\\
     show files & all, supported, music, playlists & N/A\\
     follow playlist & on, off & N/A\\
     playlist viewer icons & off,on & N/A\\
     playlist viewer indices & off,on & N/A\\
     playlist viewer track display & track name,full path & N/A\\
     recursive directory insert & off,on & N/A\\
     scroll speed & 1 to 25 & Hz\\
     scroll delay & 0 to 250 & 1/10s\\
     scroll step & 1 to 112 & pixels\\
     bidir limit & 0 to 200 & \% of screen width\\
     contrast & 0 to 63 & N/A\\
     backlight timeout & off, on, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, & seconds\\ 
                       & 15, 20, 25, 30, 45, 60, 90 & \\
     backlight when plugged & on, off & N/A\\
     disk spindown & 3 to 254 & seconds\\
     battery capacity & 1500 - 3200 & mAh\\
     idle poweroff & off, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, & minutes\\
                   & 15, 30, 45, 60 & \\
     lang & /path/filename.lng & N/A\\
     wps & /path/filename.wps & N/A\\
     autocreate bookmarks & off,on & N/A\\
     autoload bookmarks & off,on & N/A\\
     use most-recent-bookmarks & off,on & N/A\\
     talk dir & off,number,spell,enter.hover & N/A\\
     talk file & off,number,spell & N/A\\
     talk menu & off,on & N/A\\\bottomrule
  \end{longtable}
\end{center}

\subsection{Recorder{}-specific settings}
\begin{center}
  \begin{longtable}{@{}lll@{}}\toprule
    \textbf{Setting} & \textbf{Allowed Values} & \textbf{Unit}\\\midrule
     loudness & 0 to 17 & N/A\\
     super bass & on,off & N/A\\
     auto volume & off, 20ms, 2s, 4s, 8s & seconds\\
     MDB enable & on,off & N/A\\
     MDB strength & 0 to 127 & dB\\
     MDB harmonics & 0 to 100 & \%\\
     MDB center frequency & 20 to 300 & Hz\\
     MDB shape & 50 to 300 & Hz\\
     peak meter release & 1 to 126 & ?\\
     peak meter hold & off, 200ms, 300ms, 500ms, & N/A \\
                     & 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 15, 20, 30, 1min & \\
     peak meter clip hold & on, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,& N/A \\
                     & 15, 20, 25, 30, 45, 60, 90, 2min, 3min, 5min, &\\
                     & 10min, 20min, 45min, 90min & \\
     peak meter busy & on, off & N/A\\
     peak meter dbfs & on, off & on = dbfs,\\
                     &         & off = linear\\
     peak meter min  & 0 to 89 (dB) or 0 to 100 (\%) & dB or \%\\
     peak meter max  & 0 to 89 /dB) or 0 to 100 (\%) & dB or \%\\
     statusbar & on, off & N/A\\
     scrollbar & on, off & N/A\\
     volume display & graphic, numeric & N/A\\
     battery display & graphic, numeric & N/A\\
     time format & 12hour, 24hour & N/A\\
     font & /path/filename.fnt & N/A\\
     invert & on, off & N/A\\
     deep discharge & on, off & N/A\\
     trickle charge & on, off & N/A\\
     disk poweroff & on, off & N/A\\
     rec quality & 0 to 7 & 0=smallest size, 7=highest quality\\
     rec frequency & 48, 44, 32, 24, 22, 16 & kHz\\
     rec source & mic, line, spdif & N/A\\
     rec channels & mono, stereo & N/A\\
     rec mic gain & 0 to 15 & N/A\\
     rec left gain & 0 to 15 & N/A\\
     rec right gain & 0 to 15 & N/A\\
     editable recordings & off,on & N/A\\
     rec timesplit & off, 0:05, 0:10, 0:15, 0:30, 1:00, & h:mm\\
                   & 2:00, 4:00, 6:00, 8:00, 16:00, 24:00 & \\
     pre-recording time & off, 1 to 30 & s\\
     rec directory & /recordings,current & N/A\\\bottomrule
    \end{longtable}
\end{center}

\subsection{FM recorder specific settings}
\begin{center}
  \begin{tabular}{@{}lll@{}}\toprule
    \textbf{Setting} & \textbf{Allowed Values} & \textbf{Unit}\\\midrule
    Force FM mono & off,on & N/A\\\bottomrule
  \end{tabular}
\end{center}

\subsection{Example File}
\begin{verbatim}
  volume: 70
  bass: 11
  treble: 12
  balance: 0
  time format: 12hour
  volume display: numeric
  show files: supported
  wps: /.rockbox/car.wps
  lang: /.rockbox/afrikaans.lng
\end{verbatim}

\section{\label{ref:PartISection1}Differences between binaries}
There are 3 different types of firmware binaries from Rockbox website. Current Version, Daily Builds and Bleeding Edge.

\begin{itemize}
\item The current version is the latest stable version developed by the Rockbox Team. It's free of known critical bugs.  It is available from \url{http://www.rockbox.org/download/}.
\item The Daily Build is a development version of Rockbox. It supports all new features and patches developed since last stable version. It may also contain bugs! This version is generated automatically every day and can be found at \url{http://www.rockbox.org/daily.shtml}.
\item Bleeding edge builds are the same as the Daily build, but built from the latest development on each commit to the CVS repository. These builds are for people who want to test the code that developers just checked in.
\end{itemize}

\opt{recorder,recorderv2fm,ondo,player}{
There are binaries for different Jukebox models: 

\begin{itemize}
\item \begin{itemize}
\item The Player version is suitable for Archos Jukebox 5000, 6000 and
all Studio models.
\end{itemize}
\end{itemize}
\begin{itemize}
\item \begin{itemize}
\item If you have a recorder with cylindrically rounded bumpers, you
need the ``regular'' recorder version. 
\item FM Recorders are models with a FM radio.
\item The V2 recorder is a recorder in an FM Recorder form factor, but
without radio. 
\item The 8mb version requires a hardware hack, where the RAM chips are
replaced. 
\item  The Ondio builds come with and without radio support, for the
Ondio FM and SP respectively.
\end{itemize}
\end{itemize}
If in doubt as to which version to use, the table on page
\pageref{ref:Jukeboxtypetable} may be of assistance.

Note: All references in this manual to
``Recorder'' apply equally to the FM Recorder
unless otherwise specified.
}


\section{\label{ref:FirmwareLoading}Firmware Loading}
\opt{player,recorder,recorderv2fm,ondio,player}{
When your Jukebox powers on, it loads the Archos firmware in ROM, which
automatically checks your Jukebox hard disk's root folder for a file
named \textbf{archos.mod} (on the player version) or
\textbf{ajbrec.ajz} (on the recorder version). Note that Archos
firmware can only read the first ten characters of each file name in
this process, so don't rename your old firmware files with names like
archos.mod.old and so on, because it's possible that the Jukebox will
load a file other than the one you intended.
}

\section{\label{ref:PartISection4}Using ROLO (Rockbox loader)}
Rockbox is able to load and start another firmware file without rebooting. You just press PLAY on an \opt{recorder,recorderv2fm,ondio}{.ajz}\opt{player}{.mod}\opt{h1xx,h300}{.iriver}\opt{ipodnano,ipodvideo,ipodnano}{.ipod} file. This can be used to test new firmware versions without deleting your current version.

\opt{recorder,recorderv2fm,ondio}{\input{advanced_topics/archos-flashing.tex}}
